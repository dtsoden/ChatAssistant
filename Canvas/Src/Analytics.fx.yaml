Analytics As screen:
    OnVisible: |-
        =ClearCollect(ColData,GroupBy(ChatAssistantLogs,"ccat_fullname","DATA"));
        
        ClearCollect(ColDataRatings,GroupBy(ChatAssistantLogs,"cr5c4_rating","DATA_RATING"));
        
        ClearCollect(ColCharts,
            ForAll(ColData,{FullName:ccat_fullname,
                    Total: Sum(ThisRecord.DATA,TokensTotal)
                }
            )
        );
        
        ClearCollect(ColRatingsPie,
            ForAll(ColDataRatings,{Rating:cr5c4_rating & " Stars [" & CountRows(ThisRecord.DATA_RATING) & "]",
                    Total: CountRows(ThisRecord.DATA_RATING)
                }
            )
        );
        
        Set(vToggleRecord,false);

    shpRefreshIndicator As rectangle:
        Fill: =RGBA(54, 176, 75, 1)
        Height: =121
        Width: =(Analytics.Width / RefreshReportData.Duration) * RefreshReportData.Value
        ZIndex: =1

    ContMidChart As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.Regular
        Fill: =RGBA(255, 255, 255, 1)
        Height: =346
        Width: =LogTable.Width / 3
        X: =455
        Y: =334
        ZIndex: =2

        ColumnChart1 As barChart:
            Height: =330
            ItemColorSet: =ThemeColors.ChartsGraphs
            Items: =FirstN(Sort(ColCharts,Total,SortOrder.Descending),10)
            Width: =438
            X: =8
            ZIndex: =1

    ContLeftChart As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.Regular
        Fill: =RGBA(255, 255, 255, 1)
        Height: =346
        Width: =LogTable.Width / 3
        Y: =334
        ZIndex: =3

        LineChart1 As lineChart:
            Font: =Font.'Open Sans'
            Height: =330
            ItemColorSet: =ThemeColors.ChartsGraphs
            Items: =FirstN(Sort(ColCharts,Total,SortOrder.Descending),10)
            NumberOfSeries: =2
            Width: =438
            X: =8
            ZIndex: =1

    ContRightChart As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.Regular
        Fill: =RGBA(255, 255, 255, 1)
        Height: =346
        Width: =LogTable.Width / 3
        X: =910.6666666666667
        Y: =334
        ZIndex: =4

        CompositePieChart1 As group:
            Height: =5
            Width: =5
            X: =-910.6666666666667
            Y: =-330
            ZIndex: =3

            PieChart1 As pieChart:
                Explode: =1
                Height: =307
                ItemColorSet: =ThemeColors.ChartsGraphs
                Items: =Sort(Filter(ColRatingsPie,Left(Rating,1) <> "0"),Rating,SortOrder.Descending)
                Width: =430
                X: =12
                Y: =9
                ZIndex: =1

            Legend1 As legend:
                Height: =53
                ItemColorSet: =PieChart1.ItemColorSet
                Items: =PieChart1.SeriesLabels
                Size: |
                    =12
                Width: =430
                X: =12
                Y: =292
                ZIndex: =2

    ContBanner As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.Regular
        Fill: =RGBA(255, 255, 255, 1)
        Height: =40
        Width: =1366
        Y: =294
        ZIndex: =5

        lblFooterKPIHeater_1 As label:
            Align: =Align.Center
            Color: =ThemeColors.Primary
            Fill: =RGBA(245, 245, 245, 1)
            FontWeight: =FontWeight.Bold
            Size: =20
            Text: ="Top 10 Token Usage By User & AI Response Rating Where Given"
            Width: =LogTable.Width
            ZIndex: =1

    "'AppHeader-Tablet_6' As 'AppHeader-Tablet'":
        AppLogo: ='ds-Logo-BW'
        HeaderTitle: ="Analytics Dashboard"
        LeftGradient: =ThemeColors.HeaderLeft
        MidGradient: =ThemeColors.HeaderMiddle
        RadiusBottomLeftPx: =0
        RightGradient: =ThemeColors.HeaderRight
        ShowLogo: =false
        ZIndex: =6

    LogTable As dataTable.datatable:
        BorderColor: =RGBA(237, 237, 237, 1)
        BorderStyle: =BorderStyle.Solid
        DisplayMode: =DisplayMode.Edit
        Fill: =RGBA(0, 0, 0, 0)
        HeadingFill: =ThemeColors.Secondary
        HeadingFont: =Font.Lato
        HeadingFontWeight: =FontWeight.Bold
        HeadingSize: =15
        Height: =174
        Items: =Search(Sort(ChatAssistantLogs,'Created On',SortOrder.Descending),txtSearch.Text,"ccat_fullname","ccat_sent","ccat_received")
        SelectedFill: =RGBA(0, 124, 178, .2)
        Size: =12
        Width: =Analytics.Width
        X: =0
        Y: =122
        ZIndex: =7

        FullName_Column1 As dataTableColumn.textualColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="FullName"
            FieldName: ="ccat_fullname"
            FieldVariantName: ="textualColumn"
            Height: =Parent.Height
            LayoutHeight: =Parent.Height
            Order: =1
            Text: =ThisItem.FullName
            Width: =149
            X: =0
            Y: =0
            ZIndex: =3

        DTS_Column2 As dataTableColumn.dateTimeColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="DTS"
            FieldName: ="ccat_dts"
            FieldVariantName: ="dateTimeColumn"
            Height: =Parent.Height
            LayoutHeight: =Parent.Height
            Order: =2
            Text: =Text(ThisItem.DTS,DateTimeFormat.LongDateTime)
            Width: =283
            X: =0
            Y: =0
            ZIndex: =4

        Sent_Column2 As dataTableColumn.textualColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="Sent"
            FieldName: ="ccat_sent"
            FieldVariantName: ="textualColumn"
            Height: =174
            LayoutHeight: =Parent.Height
            OnSelect: |-
                =Set(vToggleRecord,!vToggleRecord);
                Set(vRecord,{itemSent:LogTable.Selected.Sent,itemReceived:LogTable.Selected.Received});
            Order: =3
            Text: =If(ThisItem.isGreyFlagged,"✂ !!!GREY FLAGGED!!! " & ThisItem.Sent, "✂ " & ThisItem.Sent)
            Width: =259
            X: =0
            Y: =0
            ZIndex: =5

        Received_Column2 As dataTableColumn.textualColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="Received"
            FieldName: ="ccat_received"
            FieldVariantName: ="textualColumn"
            Height: =Parent.Height
            LayoutHeight: =Parent.Height
            OnSelect: |-
                =Set(vToggleRecord,!vToggleRecord);
                Set(vRecord,{itemSent:LogTable.Selected.Sent,itemReceived:LogTable.Selected.Received});
            Order: =4
            Text: =ThisItem.Received
            Width: =274
            X: =0
            Y: =0
            ZIndex: =6

        TokensReceived_Column1 As dataTableColumn.numberColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: |-
                ="# Rec"
            FieldName: ="ccat_tokensreceived"
            FieldVariantName: ="numberColumn"
            Height: =Parent.Height
            LayoutHeight: =Parent.Height
            Order: =6
            Text: =ThisItem.TokensReceived
            Width: =72
            X: =0
            Y: =0
            ZIndex: =7

        TokensSent_Column1 As dataTableColumn.numberColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: |-
                ="# Sent"
            FieldName: ="ccat_tokenssent"
            FieldVariantName: ="numberColumn"
            Height: =Parent.Height
            LayoutHeight: =Parent.Height
            Order: =7
            Text: =ThisItem.TokensSent
            Width: =87
            X: =0
            Y: =0
            ZIndex: =8

        TokensTotal_Column1 As dataTableColumn.numberColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: |-
                ="# Total"
            FieldName: ="ccat_tokenstotal"
            FieldVariantName: ="numberColumn"
            Height: =Parent.Height
            LayoutHeight: =Parent.Height
            Order: =8
            Text: =ThisItem.TokensTotal
            Width: =75
            X: =0
            Y: =0
            ZIndex: =9

        Rating_Column1 As dataTableColumn.numberColumn:
            AutoWidth: =false
            DisplayMode: =DisplayMode.Edit
            FieldDisplayName: ="Rating"
            FieldName: ="cr5c4_rating"
            FieldVariantName: ="numberColumn"
            Height: =Parent.Height
            LayoutHeight: =Parent.Height
            Order: =5
            Text: =ThisItem.Rating
            Width: =77
            X: =0
            Y: =0
            ZIndex: =10

    "'lblKPI-Total' As label":
        Align: =Align.Center
        Color: =RGBA(255, 255, 255, 1)
        DisabledColor: =RGBA(255, 255, 255, 1)
        DisabledFill: =RGBA(109, 49, 162, 1)
        Fill: =ThemeColors.Accent
        FontWeight: =FontWeight.Bold
        Height: =54
        Size: =26
        Text: |-
            ="Total: " & Sum(ChatAssistantLogs,TokensTotal)
        Width: =LogTable.Width / 3
        X: =911
        Y: =714
        ZIndex: =8

    "'lblKPI-Received' As label":
        Align: =Align.Center
        Color: =RGBA(255, 255, 255, 1)
        DisabledColor: =RGBA(255, 255, 255, 1)
        DisabledFill: =RGBA(109, 49, 162, 1)
        Fill: =ThemeColors.Secondary
        FontWeight: =FontWeight.Bold
        Height: =54
        Size: =26
        Text: |-
            ="Received: " & Sum(ChatAssistantLogs,TokensReceived)
        Width: =(LogTable.Width / 3)+4
        X: =453
        Y: =714
        ZIndex: =9

    "'lblKPI-Sent' As label":
        Align: =Align.Center
        Color: =RGBA(255, 255, 255, 1)
        DisabledColor: =RGBA(255, 255, 255, 1)
        DisabledFill: =RGBA(109, 49, 162, 1)
        Fill: =ThemeColors.Primary
        FontWeight: =FontWeight.Bold
        Height: =54
        Size: =26
        Text: |-
            ="Sent: " & Sum(ChatAssistantLogs,TokensSent)
        Width: =LogTable.Width / 3
        Y: =714
        ZIndex: =10

    lblFooterKPIHeater As label:
        Align: =Align.Center
        Color: =ThemeColors.Accent
        Fill: =RGBA(245, 245, 245, 1)
        FontWeight: =FontWeight.Bold
        Height: =34
        Size: =20
        Text: ="Total Token Summary"
        Width: =LogTable.Width
        Y: =680
        ZIndex: =11

    icoFilter As icon.FilterFlatFilled:
        Color: =Color.White
        Height: =38
        HoverColor: =ThemeColors.Button
        Icon: =Icon.FilterFlatFilled
        OnSelect: =Set(vToggle,!vToggle)
        Width: =38
        X: =1325
        Y: =127
        ZIndex: =12

    shpScreenOverlay As rectangle:
        Fill: =RGBA(237, 237, 237, 0.9)
        Height: =768
        Visible: =vToggle Or vToggleRecord
        Width: =1366
        ZIndex: =13

    icoClear As icon.Erase:
        Color: =RGBA(255, 255, 0, 1)
        Height: =38
        Icon: =Icon.Erase
        OnSelect: =Reset(txtSearch)
        Visible: =!IsBlank(txtSearch.Text)
        Width: =38
        X: =1284
        Y: =127
        ZIndex: =14

    contSearch As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.ExtraBold
        Fill: =RGBA(255, 255, 255, 1)
        Height: =234
        Visible: =vToggle
        Width: =682
        X: =370
        Y: =228
        ZIndex: =15

        txtSearch As text:
            BorderColor: =RGBA(2, 94, 146, 1)
            Default: =""
            Height: =53
            HintText: ="Search"
            Size: =16
            Width: =522
            X: =75
            Y: =102
            ZIndex: =1

        icoSearch As icon.Search:
            Color: =RGBA(2, 94, 146, 1)
            Height: =53
            Icon: =Icon.Search
            Width: =53
            X: =15
            Y: =102
            ZIndex: =2

        Rectangle5 As rectangle:
            Fill: =RGBA(2, 94, 146, 1)
            Height: =42
            Width: =682
            ZIndex: =3

        Label12 As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            Height: =42
            Text: ="Search"
            Width: =522
            ZIndex: =4

        Icon10 As icon.Cancel:
            Color: =RGBA(255, 255, 255, 1)
            Height: =42
            HoverBorderColor: =RGBA(0, 32, 173, 1)
            HoverFill: =RGBA(0,132,173,1)
            Icon: =Icon.Cancel
            OnSelect: =Set(vToggle,!vToggle)
            Width: =54
            X: =628
            ZIndex: =5

        btnGo As button:
            Fill: =RGBA(2,94,146,1)
            Height: =53
            HoverFill: =RGBA(0,132,173,1)
            OnSelect: =Set(vToggle,!vToggle)
            Text: ="GO"
            Width: =53
            X: =611
            Y: =102
            ZIndex: =6

    ContRecord As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.ExtraBold
        Fill: =RGBA(241, 244, 249, 1)
        Height: =370
        Visible: =vToggleRecord
        Width: =955
        X: =206
        Y: =199
        ZIndex: =16

        lblAir As label:
            FontWeight: =FontWeight.Bold
            Text: |-
                ="User Question: "
            VerticalAlign: =VerticalAlign.Top
            Width: =142
            X: =21
            Y: =84
            ZIndex: =1

        lblUinc As label:
            FontWeight: =FontWeight.Bold
            Text: |-
                ="AI Response: "
            VerticalAlign: =VerticalAlign.Top
            Width: =141
            X: =41
            Y: =194
            ZIndex: =2

        lblUserInquery As label:
            Height: =97
            Overflow: =Overflow.Scroll
            Text: =TrimEnds(vRecord.itemSent)
            VerticalAlign: =VerticalAlign.Top
            Width: =714
            X: =160
            Y: =84
            ZIndex: =3

        lblAIResponse As label:
            Height: =165
            Overflow: =Overflow.Scroll
            Text: =TrimEnds(vRecord.itemReceived)
            VerticalAlign: =VerticalAlign.Top
            Width: =714
            X: =160
            Y: =194
            ZIndex: =4

        Rectangle5_1 As rectangle:
            Fill: =ThemeColors.Accent
            Height: =42
            Width: =955
            ZIndex: =5

        Label12_1 As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            Height: =42
            Text: =LogTable.Selected.FullName & " Interaction Log " & LogTable.Selected.DTS
            Width: =955
            ZIndex: =6

        icoClose As icon.Cancel:
            Color: =RGBA(255, 255, 255, 1)
            Height: =42
            HoverBorderColor: =RGBA(0, 32, 173, 1)
            HoverColor: =Color.White
            HoverFill: =ThemeColors.Secondary
            Icon: =Icon.Cancel
            OnSelect: =Set(vToggleRecord,!vToggleRecord)
            Width: =54
            X: =901
            ZIndex: =7

        icoCopy1 As icon.Copy:
            Color: =ThemeColors.Accent
            Height: =40
            Icon: =Icon.Copy
            OnSelect: =Copy(lblUserInquery.Text);Notify("User Question copied to the clipboard",NotificationType.Success,3000);
            Width: =40
            X: =895
            Y: =100
            ZIndex: =8

        icoCopy1_1 As icon.Copy:
            Color: =ThemeColors.Accent
            Height: =40
            Icon: =Icon.Copy
            OnSelect: =Copy(lblAIResponse.Text);Notify("AI Response copied to the clipboard",NotificationType.Success,3000);
            Width: =40
            X: =894
            Y: =244
            ZIndex: =9

    icoBack2 As icon.BackArrow:
        Color: =RGBA(255, 255, 255, 1)
        Icon: =Icon.BackArrow
        OnSelect: =Navigate(General,ScreenTransition.CoverRight);Set(vAdminNav,true)
        X: =1285
        Y: =20
        ZIndex: =17

    RefreshReportData As timer:
        AutoStart: =true
        Duration: =30000
        Fill: =Color.Transparent
        HoverFill: =ThemeColors.Primary
        OnTimerEnd: |
            =Set(spinner,!spinner);
            
            Refresh(ChatAssistantLogs);
            
            ClearCollect(ColData,GroupBy(ChatAssistantLogs,"ccat_fullname","DATA"));
            
            ClearCollect(ColDataRatings,GroupBy(ChatAssistantLogs,"cr5c4_rating","DATA_RATING"));
            
            ClearCollect(ColCharts,
                ForAll(ColData,{FullName:ccat_fullname,
                        Total: Sum(ThisRecord.DATA,TokensTotal)
                    }
                )
            );
            
            ClearCollect(ColRatingsPie,
                ForAll(ColDataRatings,{Rating:cr5c4_rating & " Stars [" & CountRows(ThisRecord.DATA_RATING) & "]",
                        Total: CountRows(ThisRecord.DATA_RATING)
                    }
                )
            );
            Set(spinner,!spinner);
        PressedColor: =Color.White
        PressedFill: =ThemeColors.Accent
        Repeat: =true
        Text: ="Data Refresh in " &  Text(Time(0, 0, (Self.Duration-Self.Value)/1000), "ss")
        X: =1088
        Y: =32
        ZIndex: =18

    imgSpinnerRefresh As image:
        Image: =SpinnerGrey
        Visible: =spinner
        X: =633
        Y: =334
        ZIndex: =19

    imgLogo2 As image:
        Image: ='240'
        OnSelect: =Launch(vAppURL & "&hidenavbar=true",{},"_self")
        X: =20
        ZIndex: =20

